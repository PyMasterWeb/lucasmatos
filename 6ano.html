<!DOCTYPE html>
<html lang="pt-br">
<head>      
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6¬∫ Ano - Portugu√™s</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="aluno.html">√Årea do Aluno - L√≠ngua Portuguesa</a>
      <button id="logoutBtn" class="btn btn-outline-light btn-sm">Sair</button>
    </div>
  </nav>              

    <!-- CONTE√öDO PRINCIPAL -->
  <div class="container mt-4">
    <h2 class="mb-4" >üìö Meus Conte√∫dos</h2>
    <div class="row g-4">

<h4>Materiais dispon√≠veis
  <button class="btn btn-sm btn-secondary" onclick="carregarArquivos()">üîÑ Recarregar</button>
</h4>
<div id="infoTurma" class="alert alert-info"></div>
<ul id="listaArquivos" class="list-group"></ul>
<script>
let turmaAluno = '';


  const lista = document.getElementById('listaArquivos')
  
  // Listar todos os arquivos de professor
  const { data, error } = await supabaseClient.storage
    .from('DBEscola')
    .list('professor', { recursive: true })

  if (error) {
    console.error('Erro ao carregar arquivos:', error)
    lista.innerHTML = '<li class="list-group-item text-danger">Erro ao carregar arquivos</li>'
    return
  }

  if (!data || data.length === 0) {
    lista.innerHTML = '<li class="list-group-item">Nenhum arquivo dispon√≠vel para sua turma</li>'
    return
  }

  lista.innerHTML = ''
  let arquivosEncontrados = 0

  for (const file of data) {
    // Filtrar apenas arquivos da turma do aluno
    // Estrutura: professor/disciplina/turma/tipo/arquivo
    if (file.name.includes(`/${turmaAluno}/`)) {
      const { data: urlData } = supabaseClient.storage
        .from('DBEscola')
        .getPublicUrl(`professor/${file.name}`)

      const li = document.createElement('li')
      li.className = 'list-group-item d-flex justify-content-between align-items-center'
      
      // Extrair apenas o nome do arquivo
      const nomeArquivo = file.name.split('/').pop()
      
      li.innerHTML = `
        <span>${nomeArquivo}</span>
        <a href="${urlData.publicUrl}" target="_blank" class="btn btn-sm btn-primary">
          Baixar
        </a>
      `
      lista.appendChild(li)
      arquivosEncontrados++
    }
  }

  if (arquivosEncontrados === 0) {
    lista.innerHTML = '<li class="list-group-item">Nenhum arquivo dispon√≠vel para sua turma</li>'
  }



// Carregar arquivos quando a p√°gina estiver pronta
setTimeout(() => {
  carregarArquivos()
}, 1000)
</script>



<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabaseUrl = 'https://brauqbxjvixrennhyqrk.supabase.co'
  const supabaseKey = 'sb_publishable_4x7IM5uariLJS8hW1YO8KA_bK0sngvi'

  const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey)

  // Verificar autentica√ß√£o do Supabase
  supabaseClient.auth.onAuthStateChange((event, session) => {
    if (!session) {
      // N√£o autenticado: redireciona
      window.location.href = "index.html";
    }
  });

  // Logout
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    await supabaseClient.auth.signOut()
    window.location.href = "index.html"
  })
</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
        
    </body>
</html>